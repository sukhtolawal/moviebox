!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e["@transsion/byteh5privacy"]=t()}(this,function(){"use strict";function e(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)}return i}function t(t){for(var i=1;i<arguments.length;i++){var n=null!=arguments[i]?arguments[i]:{};i%2?e(Object(n),!0).forEach(function(e){o(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function r(e,t){return s(e)||u(e,t)||c(e,t)||p()}function s(e){if(Array.isArray(e))return e}function u(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var n,a,o=[],r=!0,s=!1;try{for(i=i.call(e);!(r=(n=i.next()).done)&&(o.push(n.value),!t||o.length!==t);r=!0);}catch(e){s=!0,a=e}finally{try{r||null==i.return||i.return()}finally{if(s)throw a}}return o}}function c(e,t){if(e){if("string"==typeof e)return l(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?l(e,t):void 0}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function p(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function d(e,t){var i=new Map(e.map(function(e){return[e.scopeName,e]}));return t.forEach(function(t){if(i.has(t.scopeName)){var n=e.findIndex(function(e){return e.scopeName===t.scopeName});e[n]=t}else e.push(t)}),e}function v(e,t){var i=new Map(t.map(function(e){return[e.scopeName,e]}));return Object.keys(e).forEach(function(t){var n=e[t].scopeName||"";n&&i.has(n)&&Object.assign(e[t],i.get(n));var a=e[t];void 0===a.defaultAuthorization||a.defaultAuthorization||i.has(n)||(e[t].rejectCall=!0)}),e}function h(e,t,i){var n=e.findIndex(function(e){return e[i]===t[i]});-1!==n?e[n]=t:e.push(t)}function g(e,t){return{text:e,bgcolor:t,isShow:!(arguments.length>2&&void 0!==arguments[2])||arguments[2],customText:arguments.length>3&&void 0!==arguments[3]?arguments[3]:""}}function f(e,t){var i=e.validityTimeType,n=e.limited;i===K.forever?(t.button1=g(Y.allow,Z.blue),t.button2=g(Y.dontAllow,Z.white),t.button3.isShow=!1):i===K.once?(t.button1=g(Y.onlyThisTime,Z.blue),t.button2=g(Y.dontAllow,Z.white)):i===K.custom&&n?(t.button1=g(Y.whileUsingTheApp,Z.blue),t.button2=g(Y.onlyThisTime,Z.white),t.button3=g(Y.dontAllow,Z.white)):(t.button1=g(Y.onlyThisTime,Z.blue),t.button2=g(Y.allow,Z.white),t.button3=g(Y.rejectAndDontShowAgain,Z.white))}function y(){var e,t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:90,n=new Promise(function(i,n){e=i,t=n});return"interactive"===document.readyState?e("interactive"):"complete"===document.readyState?e("complete"):window.addEventListener("load",function(){return e("load")}),setTimeout(function(){return t("timeout")},1e3*i),n}var m={title:{privacy:"Welcome to ",addHome:"Get the MiniApp on your device and start using now",addHomeGame:"Get the game on your device and play now"},baseContent:"By continuing, you agree to MiniApp's ",privacyPolocyContent:"Privacy Policy",and:" and ",userAgreementContent:"User Agreement",buttonText:"Get and Use",buttonTextGame:"Get and Play",period:".",privacyAgreeTv:"Agree",privacyCancelTv:"Cancel",gdprNoticeContent:""},A={title:{privacy:"Bienvenue à ",addHome:"Obtenez la MiniApp sur votre appareil et démarrez utiliser maintenant",addHomeGame:"Obtenez le jeu sur votre appareil et jouez maintenant"},baseContent:"En continuant, vous acceptez les conditions d'utilisation de MiniApp ",privacyPolocyContent:"politique de confidentialité",and:" et ",userAgreementContent:"Contrat d'utilisation",buttonText:"Obtenir et utiliser",buttonTextGame:"Obtenez et jouez",period:".",privacyAgreeTv:"Accepter",privacyCancelTv:"Annuler",gdprNoticeContent:""},S={title:{privacy:"مرحبا بكم في ",addHome:"احصل على MiniApp على جهازك وابدأ في استخدامه الآن",addHomeGame:"احصل على اللعبة على جهازك والعبها الآن"},baseContent:"من خلال المتابعة، فإنك توافق على MiniApp ",privacyPolocyContent:"سياسة الخصوصية",and:" و ",userAgreementContent:"اتفاقية المستخدم",buttonText:"الحصول على واستخدام",buttonTextGame:"احصل على والعب",period:".",privacyAgreeTv:"يوافق",privacyCancelTv:"يلغي",gdprNoticeContent:""},w={title:{privacy:"Добро пожаловать в ",addHome:"Установите MiniApp на свое устройство и начните использовать прямо сейчас",addHomeGame:"Загрузите игру на свое устройство и играйте прямо сейчас"},baseContent:"Продолжая, вы соглашаетесь с условиями MiniApp ",privacyPolocyContent:"политика конфиденциальности",and:" и ",userAgreementContent:"Пользовательское соглашение",buttonText:"Получите и используйте",buttonTextGame:"Бери и играй",period:".",privacyAgreeTv:"Соглашаться",privacyCancelTv:"Отмена",gdprNoticeContent:""},T={title:{privacy:"Selamat Datang di ",addHome:"Dapatkan MiniApp di perangkat Anda dan mulai gunakan sekarang",addHomeGame:"Dapatkan gamenya di perangkat Anda dan mainkan sekarang"},baseContent:"Dengan melanjutkan, Anda menyetujui MiniApp ",privacyPolocyContent:"Kebijakan Privasi",and:" Dan ",userAgreementContent:"Perjanjian Pengguna",buttonText:"Dapatkan dan Gunakan",buttonTextGame:"Dapatkan dan Mainkan",period:".",privacyAgreeTv:"Setuju",privacyCancelTv:"Membatalkan",gdprNoticeContent:""},C={title:{privacy:"Bem-vindo ao ",addHome:"Obtenha o MiniApp no ​​seu dispositivo e comece a usar agora",addHomeGame:"Baixe o jogo no seu dispositivo e jogue agora"},baseContent:"Ao continuar, você concorda com os termos do MiniApp ",privacyPolocyContent:"política de Privacidade",and:" e ",userAgreementContent:"Contrato do usuário",buttonText:"Obtenha e use",buttonTextGame:"Obtenha e jogue",period:".",privacyAgreeTv:"Concordar",privacyCancelTv:"Cancelar",gdprNoticeContent:""},b={title:{privacy:"Bienvenido a ",addHome:"Obtén la MiniApp en tu dispositivo y comienza a usarla ahora",addHomeGame:"Obtén el juego en tu dispositivo y juega ahora"},baseContent:"Al continuar, aceptas las condiciones de MiniApp ",privacyPolocyContent:"política de privacidad",and:" y ",userAgreementContent:"Acuerdo de usuario",buttonText:"Obtener y usar",buttonTextGame:"Obtener y jugar",period:".",privacyAgreeTv:"Aceptar",privacyCancelTv:"Cancelar",gdprNoticeContent:""},P={title:{privacy:"आपका स्वागत है ",addHome:"अपने डिवाइस पर MiniApp प्राप्त करें और अभी उपयोग करना शुरू करें",addHomeGame:"अपने डिवाइस पर गेम प्राप्त करें और अभी खेलें"},baseContent:"जारी रखकर, आप MiniApp से सहमत होते हैं ",privacyPolocyContent:"गोपनीयता नीति",and:" और ",userAgreementContent:"उपयोगकर्ता का समझौता।",buttonText:"प्राप्त करें और उपयोग करें",buttonTextGame:"प्राप्त करें और खेलें",period:"",privacyAgreeTv:"सहमत",privacyCancelTv:"रद्द करना",gdprNoticeContent:""},k={title:{privacy:"ยินดีต้อนรับสู่ ",addHome:"รับ MiniApp บนอุปกรณ์ของคุณและเริ่มใช้งานทันที",addHomeGame:"รับเกมบนอุปกรณ์ของคุณและเล่นทันที"},baseContent:"การดำเนินการต่อแสดงว่าคุณยอมรับ MiniApp ",privacyPolocyContent:"นโยบายความเป็นส่วนตัว",and:" และ ",userAgreementContent:"ข้อตกลงผู้ใช้",buttonText:"รับและใช้งาน",buttonTextGame:"รับและเล่น",period:".",privacyAgreeTv:"เห็นด้วย",privacyCancelTv:"ยกเลิก",gdprNoticeContent:""},I={title:{privacy:"Xush kelibsiz ",addHome:"Qurilmangizga MiniAppni yuklab oling va hoziroq foydalanishni boshlang",addHomeGame:"Oʻyinni qurilmangizga yuklab oling va hozir oʻynang"},baseContent:"Davom etish orqali siz MiniApp-ga rozilik bildirasiz ",privacyPolocyContent:"Maxfiylik siyosati",and:" va ",userAgreementContent:"Foydalanuvchi shartnomasi",buttonText:"Oling va foydalaning",buttonTextGame:"Oling va o'ynang",period:".",privacyAgreeTv:"Rozi",privacyCancelTv:"Bekor qilish",gdprNoticeContent:""},_=new Map([["in",T],["id",T],["id-ID",T],["ru-RU",w],["ru",w],["ar-EG",S],["ar",S],["en-US",m],["en",m],["fr-FR",A],["fr",A],["pt",C],["pt-PT",C],["es",b],["es-ES",b],["th",k],["th-TH",k],["hi",P],["hi-IN",P],["uz",I],["uz-UZ",I]]),M=function(){function e(){i(this,e),this.queueSet={}}return a(e,[{key:"get",value:function(e){return this.queueSet[e]||(this.queueSet[e]=[]),this.queueSet[e]}},{key:"pushTo",value:function(e,t){this.get(e).push(t)}},{key:"has",value:function(e){return"[object Array]"===Object.prototype.toString.call(this.queueSet[e])}},{key:"del",value:function(e,t){var i=this;t?"*"===e?Object.keys(this.queueSet).filter(function(e){return i.has(e)}).forEach(function(e){i.queueSet[e]=i.queueSet[e].filter(function(e){return e.handler!==t})}):this.queueSet[e]=this.queueSet[e].filter(function(e){return e.handler!==t}):this.queueSet[e]=[]}}]),e}(),N=function(){function e(){i(this,e),this.handlerQueueSet=new M,this.messageQueueSet=new M}return a(e,[{key:"fireMessage",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e&&e.type&&this.handlerQueueSet.get(e.type)&&(i.once||this.messageQueueSet.pushTo(e.type,e),this.handlerQueueSet.get(e.type).forEach(function(i){t.handlerWrapper(i,e.type,e)}),this.handlerQueueSet.get("*").forEach(function(i){t.handlerWrapper(i,"*",e)})),this}},{key:"onMessage",value:function(e,t){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return"[object Array]"===Object.prototype.toString.call(e)?(e.forEach(function(e){return i.onMessage(e,t,n)}),this):(this.handlerQueueSet.pushTo(e,{handler:t,once:n.once}),!0===n.listenPreviousEvent&&this.messageQueueSet.has(e)&&this.handlerWrapper({handler:t,once:n.once},e,this.messageQueueSet.get(e)),this)}},{key:"delHandler",value:function(e,t){return this.handlerQueueSet.del(e,t),this}},{key:"handlerWrapper",value:function(e,t,i){var n=e.handler,a=e.once;return!!n&&(n.call(this,i),a&&this.handlerQueueSet.del(t,n),!0)}}],[{key:"merge",value:function(){for(var t=new e,i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];return[].concat(n).forEach(function(e){e.onMessage("*",function(e){return t.fireMessage(e)})}),t}}]),e}(),D=function(){return(new Date).getTime()+""+1*(Math.random()+"").replace("0.","").replace(/^0/,"1").slice(0,6)},z=function(){},O=function(){function e(){i(this,e)}return a(e,[{key:"callNativeApi",value:function(e,t,i,n){var a=E(),o={abilityName:"Api",renderId:t,target:"native",source:"render",dataJson:{methodName:e,callbackId:n,dataJson:JSON.stringify({time:a})},callbackId:n,time:(new Date).getTime()};i&&(o.dataJson.args=JSON.stringify(i)),this.sendContent(o)}},{key:"feedBackToNativeConsumeTime",value:function(e){if(e&&("string"==typeof e||"number"==typeof e)){var t=(new Date).getTime(),i=t-e;i<0||j(i)}}},{key:"sendContent",value:function(e){window.openByteBridge?location.href="bytebridge://__TmcRenderToWorkerMsg:".concat(JSON.stringify(e)):null!=window.dlth5bridge&&null!=window.dlth5bridge.h5SendToNative?window.dlth5bridge.h5SendToNative("__TmcRenderToWorkerMsg:"+JSON.stringify(e)):console.log("__TmcRenderToWorkerMsg:"+JSON.stringify(e))}}]),e}(),x=function(){function e(){i(this,e)}return a(e,[{key:"invokeAbilityName",value:function(e){try{if(e.callbackId&&"string"==typeof e.callbackId&&e.callbackId.startsWith("cb_")){var t={once:!0};this.callback(e,t)}}catch(e){console.log("error when invokeAbilityName",e)}}},{key:"callback",value:function(e,t){var i=JSON.parse(e.dataJson);this.sendMessage({type:e.callbackId,value:i},t)}},{key:"sendMessage",value:function(e,t){window.tmcInterface&&window.tmcInterface.communicator&&window.tmcInterface.communicator.fireMessage(e,t)}}]),e}(),U=function(){function e(){i(this,e),window.tmcInterface||(window.tmcInterface={communicator:new N,sendMessage:new O,dispatchEventHandler:new x});var t=window.tmcInterface,n=t.communicator,a=t.sendMessage,o=t.dispatchEventHandler;this.communicator=n,this.sendMessage=a,this.dispatchEventHandler=o,this.openByteBridge()}return a(e,[{key:"callApi",value:function(e,t,i){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=window.pageId,o="cb_"+D(),r=n;t.keepAlive&&(r=!1,o="cb_"+e+"_"+a),window.tmcInterface.communicator.handlerQueueSet.has(o)&&window.tmcInterface.communicator.handlerQueueSet.del(o),window.tmcInterface.communicator.onMessage(o,i||z,{once:r}),window.tmcInterface.sendMessage.callNativeApi(e,a,t,o)}},{key:"openByteBridge",value:function(){this.callApi("openByteBridge",{},function(e){if(e&&e.value&&"true"==e.value.success&&e.value.data){var t=JSON.parse(e.value.data),i=t.open;window.openByteBridge=i}else window.openByteBridge=!1})}}],[{key:"getInstance",value:function(){return this.instance||(this.instance=new e),this.instance}}]),e}(),j=function(e){window&&Array.isArray(window.consumeTime)?window.consumeTime.push(e):window&&void 0===window.consumeTime&&(window.consumeTime=[e])},E=function(){var e=[0];return Array.isArray(window.consumeTime)&&window.consumeTime.length>0&&(e=window.consumeTime,window.consumeTime=[]),e},B=U.getInstance(),L=function(e){window.tmcInterface.dispatchEventHandler.invokeAbilityName(e),window.tmcInterface.sendMessage.feedBackToNativeConsumeTime(e.time)};window._bindDltMessage||(window.onMessage=L,window._bindDltMessage=!0),window.addEventListener("message",L);var H=[{scopeName:"getTempUniqueId",apis:["getTempUniqueId"],userAuthorization:!1,defaultAuthorization:!0,validityTime:-1,validityTimeType:-1,apiType:"basic",limited:!1},{scopeName:"fileSystem",apis:["fileSystemManager.access","fileSystemManager.copyFile","fileSystemManager.getFileInfo","fileSystemManager.readdir","fileSystemManager.mkdir","fileSystemManager.rmdir","fileSystemManager.rename","fileSystemManager.saveFile","fileSystemManager.fstat","fileSystemManager.unlink","fileSystemManager.unzip","fileSystemManager.open","fileSystemManager.close","fileSystemManager.stat","fileSystemManager.read","fileSystemManager.readFile","fileSystemManager.write","fileSystemManager.writeFile"],userAuthorization:!1,defaultAuthorization:!0,validityTime:-1,validityTimeType:-1,apiType:"basic",limited:!1},{scopeName:"fullScreen",apis:[],userAuthorization:!1,defaultAuthorization:!1,validityTime:-1,validityTimeType:-1,apiType:"basic",limited:!1},{scopeName:"navigateToMiniProgram",apis:["navigateToMiniProgram"],userAuthorization:!1,defaultAuthorization:!0,validityTime:-1,validityTimeType:-1,apiType:"basic",limited:!1},{scopeName:"network",apis:["getNetworkType","onNetworkStatusChange","offNetworkStatusChange"],userAuthorization:!1,defaultAuthorization:!0,validityTime:-1,validityTimeType:-1,apiType:"basic",limited:!1},{scopeName:"sensitiveBasicAbility",apis:["simulateTouchEvent","systemShare"],userAuthorization:!1,defaultAuthorization:!1,validityTime:-1,validityTimeType:-1,apiType:"basic",limited:!1},{scopeName:"basicAbility",apis:["getSystemInfo","getSystemInfoAsync","getCountryInfo","getLaunchOptions","getHardwareInfo","getBatteryInfo","queryShortcutExists","addToHomeScreen","vibrate","vibrateShort","vibrateLong","request","getStorage","setStorage","clearStorage","removeStorage","previewImage","getScreenBrightness","setScreenBrightness","setKeepScreenOn","getMiniappResumedStatus","playForegroundAudio","playAudioEffect","getAvailableAudioSources","openSystemSetting","openSystemSettingWithAction","openSystemBluetoothSetting","getUpdateManager","appUpdateApplyUpdate","appUpdateOnCheckForUpdate","appUpdateOnUpdateReady","appUpdateOnUpdateFailed","appUpdateForceUpdateAppInfo","appUpdateDownloadNew","reLaunch","getUserAgent","darkThemeIsEnabled","report"],userAuthorization:!1,defaultAuthorization:!0,validityTime:-1,validityTimeType:-1,apiType:"basic",limited:!1},{scopeName:"downloadFile",apis:["downloadFile"],userAuthorization:!0,defaultAuthorization:!0,validityTime:-1,validityTimeType:-1,apiType:"basic",limited:!1},{scopeName:"openExternalApp",apis:["openExternalApp"],userAuthorization:!0,defaultAuthorization:!1,validityTime:-1,validityTimeType:0,apiType:"basic",limited:!1},{scopeName:"navigateTo",apis:["navigateToDeeplink","navigateToApp"],userAuthorization:!0,defaultAuthorization:!1,validityTime:0,validityTimeType:0,apiType:"basic",limited:!1},{scopeName:"navigateToOutsideBrowser",apis:["navigateToOutsideBrowser"],userAuthorization:!0,defaultAuthorization:!1,validityTime:-1,validityTimeType:0,apiType:"basic",limited:!1},{scopeName:"sms",apis:["sendToSms"],userAuthorization:!0,defaultAuthorization:!0,validityTime:0,validityTimeType:0,apiType:"basic",limited:!1},{scopeName:"phoneCall",apis:["makePhoneCall"],userAuthorization:!0,defaultAuthorization:!0,validityTime:0,validityTimeType:0,apiType:"basic",limited:!1},{scopeName:"uniqueId",apis:["getUniqueId"],userAuthorization:!1,defaultAuthorization:!0,validityTime:-1,validityTimeType:-1,apiType:"userInfo",limited:!1},{scopeName:"sim",apis:["getCountryByIso"],userAuthorization:!1,defaultAuthorization:!0,validityTime:-1,validityTimeType:-1,apiType:"userInfo",limited:!1},{scopeName:"uploadFile",apis:["uploadFile"],userAuthorization:!0,defaultAuthorization:!0,validityTime:-1,validityTimeType:1,apiType:"userInfoAuth",limited:!0},{scopeName:"readPhotosAlbum",apis:["chooseMedia","saveImageToPhotosAlbum"],userAuthorization:!0,defaultAuthorization:!0,validityTime:2592e6,validityTimeType:1,apiType:"userInfoAuth",limited:!0},{scopeName:"userLocation",apis:["getLocation"],userAuthorization:!0,defaultAuthorization:!0,validityTime:0,validityTimeType:1,apiType:"userInfoAuth",limited:!0},{scopeName:"recorder",apis:["audioRecordStart","audioRecordStop","audioRecordPause","audioRecordResume"],userAuthorization:!0,defaultAuthorization:!0,validityTime:0,validityTimeType:1,apiType:"userInfoAuth",limited:!0},{scopeName:"clipboard",apis:["getClipboard","setClipboard"],userAuthorization:!0,defaultAuthorization:!0,validityTime:-1,validityTimeType:-1,apiType:"userInfoAuth",limited:!1},{scopeName:"scanCode",apis:["scanCode"],userAuthorization:!0,defaultAuthorization:!0,validityTime:-1,validityTimeType:-1,apiType:"userInfoAuth",limited:!1},{scopeName:"wifi",apis:["startWifi","stopWifi","getWifiList","getConnectedWifi","onWifiConnected","offWifiConnected","connectWifi","onGetWifiList","offGetWifiList"],userAuthorization:!0,defaultAuthorization:!0,validityTime:-1,validityTimeType:-1,apiType:"userInfoAuth",limited:!1},{scopeName:"bluetooth",apis:["openBluetoothAdapter","getBluetoothAdapterState","closeBluetoothAdapter","onBluetoothAdapterStateChange","offBluetoothAdapterStateChange","startBluetoothDevicesDiscovery","stopBluetoothDevicesDiscovery","onBluetoothDeviceFound","offBluetoothDeviceFound","createBLEConnection","getConnectedBluetoothDevices","closeBLEConnection","onBLEConnectionStateChange","offBLEConnectionStateChange","getBLEDeviceServices","getBLEDeviceCharacteristics","writeBLECharacteristicValue","readBLECharacteristicValue","notifyBLECharacteristicValueChange","onBLECharacteristicValueChange","offBLECharacteristicValueChange"],userAuthorization:!0,defaultAuthorization:!0,validityTime:2592e6,validityTimeType:-1,apiType:"userInfoAuth",limited:!1},{scopeName:"notifyMessage",apis:["requestSendMsgPermission"],userAuthorization:!0,validityTime:-1,validityTimeType:-1,defaultAuthorization:!1,apiType:"basic",limited:!1},{scopeName:"screenshot",apis:["takeScreenshot"],userAuthorization:!1,defaultAuthorization:!1,validityTime:-1,validityTimeType:-1,apiType:"basic",limited:!1}],F={version:"1.0",versionKey:"v1"},q=["requestSendMsgPermission"],G=["requestSendMsgPermission"],W=6048e5,J={allow:0,reject:-1,intercept:1},R={reject:0,forever:1,once:2,whileInUse:3},V={notSet:0},Q={unauthorized:{errMsg:"User Unauthorized",errCode:905},onlyWhileUsing:{errMsg:"Allow Only While Using The App",errCode:906},notThisMiniapp:{errMsg:"Request denied",errCode:907},innerError:{errMsg:"Internal API Calling Error",errCode:908},notAgreeAgreement:{errMsg:"The user did not agree to the developer agreement",errCode:909},noPermission:{errMsg:"No permissions",errCode:910}},K={forever:-1,once:0,custom:1},Y={allow:"1",dontAllow:"2",onlyThisTime:"3",whileUsingTheApp:"4",rejectAndDontShowAgain:"5"},X={2:"0",1:"1",4:"3",5:"0",3:"2"},Z={white:"0",blue:"1"},$=function(e){return"[object Array]"===Object.prototype.toString.apply(e)},ee=function(){function e(){i(this,e),this.initStatus=!1,this._limitAuthCall=!0,this.miniAppInfo=null,this.allowToCallNative=this.allowToCallNative.bind(this),this.allowToCallNativeIncept=this.allowToCallNativeIncept.bind(this),this._apiConfigs={},this.SEVEN_DAYS=W,this.start_ts=(new Date).getTime(),this._intercept=!0,this._notConfigDevModal=!1}return a(e,[{key:"_callPrivateApi",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];B.callApi(e,t,function(e){i&&i(e)},n)}},{key:"getAPIAuthConfig",value:function(){var e=this;return new Promise(function(t,i){e._callPrivateApi("getFrameworkStorage",{key:"dlt_api_auth_configs"},function(e){if(e&&e.value&&"true"==e.value.success)try{if(e.value.data){var n=JSON.parse(e.value.data);t(n)}else t("")}catch(e){i("dlt_api_auth_configs error")}i("dlt_api_auth_configs error")})})}},{key:"queryDynamicScopeConfig",value:function(){var e=this;return new Promise(function(t,i){e._callPrivateApi("queryDynamicScopeConfig",{},function(e){if(e&&e.value&&"true"==e.value.success)try{if(e.value.scopeConfig){var n=JSON.parse(e.value.scopeConfig);t(n)}else t("")}catch(e){i("queryDynamicScopeConfig error")}})})}},{key:"getLocalAuthRecord",value:function(e){var t=this;return new Promise(function(i,n){t._callPrivateApi("getGlobalStorage",{globalFlag:"scope_storageV2",key:"key_allow_scope_list_".concat(e),dataType:"String"},function(e){if(e&&e.value&&"true"==e.value.success)try{if(e.value.data){var t=JSON.parse(e.value.data);i(t)}else i([])}catch(e){n("dlt_api_auth_configs error")}n("dlt_api_auth_configs error")})})}},{key:"getAuth",value:function(e,t){var i=this,n={logo:"",title:"",scopeName:e.scopeName,customContent:"",button1:{isShow:!1,bgcolor:"0",customText:"",text:"1"},button2:{isShow:!1,bgcolor:"0",customText:"",text:"1"},button3:{isShow:!1,bgcolor:"0",customText:"",text:"1"},notShowAgain:{isShow:!1,text:""},titleTips:""};return f(e,n),G.includes(t)&&(n.notShowAgain.isShow=!0),new Promise(function(t,a){i._callPrivateApi("showScopePermissionDialog",n,function(i){if(i&&i.value&&"true"==i.value.success){var a={clickBtn:n["button".concat(i.value.click)],isClickNotShowAgain:i.value.isClickNotShowAgain,scopeName:e.scopeName,authTimeStamp:(new Date).getTime(),authChangeTimeStamp:(new Date).getTime()};t(a)}})})}},{key:"saveAPIAuthConfig",value:function(e){this._callPrivateApi("setFrameworkStorage",{key:"dlt_api_auth_configs",data:JSON.stringify(e)})}},{key:"generateAPIControl",value:function(){var e=this;return new Promise(function(t,i){Promise.all([e.getMiniAppScopeInfo(),e.getAPIAuthConfig(),e.queryDynamicScopeConfig()]).then(function(i){var n=r(i,3),a=n[0],o=n[1],s=n[2];if(void 0!==s.dontShowTimeMS&&s.dontShowTimeMS>0&&(e.SEVEN_DAYS=s.dontShowTimeMS),void 0===o._authListConfig){var u=e.serializationData(H);u._authListConfig=F,e.saveAPIAuthConfig(u),e._apiConfigs=v(u,a),e.saveTempAuth(e.miniAppInfo.appId,e._apiConfigs)}else{var c=H.version,l=H.versionKey,p=o._authListConfig,h=p.version,g=p.versionKey,f=+"".concat(c).split(".")[1]||0,y=+"".concat(h).split(".")[1]||0,m=+"".concat(l).split("v")[1]||0,A=+"".concat(g).split("v")[1]||0;if(A==m&&f>y||A<m){var S=e.serializationData(H);S._authListConfig=F,e.saveAPIAuthConfig(S),e._apiConfigs=v(S,a),e.saveTempAuth(e.miniAppInfo.appId,e._apiConfigs)}else e._apiConfigs=v(o,a),e.saveTempAuth(e.miniAppInfo.appId,e._apiConfigs);if(void 0===s[g]||void 0===s[g].version||!s[g].version)return void t(e._apiConfigs);var w=+"".concat(h).split(".")[1]||0,T=s[g].version;if((+"".concat(T).split(".")[1]||0)>w){var C=+new Date;e.getAuthFetchTs().then(function(t){var i=t.lastFetchTs,n=t.lastVersion;e.shouldFetch(i,n,T,s[g].url)&&(e.storeAuthFetchTs({lastFetchTs:C,lastVersion:s[g].version}),e.fetch(s[g].url,{method:"GET"}).then(function(t){var i=e.dlt._getLocalApiConfig(),n=d(i.authList,t),a=e.serializationData(n);a._authListConfig={version:s[g].version,versionKey:g},e.saveAPIAuthConfig(a)}))})}}t(e._apiConfigs)}).catch(console.log)})}},{key:"shouldFetch",value:function(e,t,i,n){if(!n)return!1;var a=(new Date).getTime(),o=e>0?a-e:-1,r=-1==e,s=o>432e5,u=t!=i,c=t==i&&o>=432e5;return r||s||u||c}},{key:"serializationData",value:function(e){var t={};return e.forEach(function(e){e&&e.apis.length>0&&e.apis.forEach(function(i){t[i]=e,delete t[i].apis})}),t}},{key:"fetch",value:function(e){var i=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(a,o){i._callPrivateApi("request",t({url:e},n),function(e){if(e&&e.value&&"true"==e.value.success&&e.value.response)try{var t=JSON.parse(e.value.response);a(t)}catch(e){o(e)}else o(e)})})}},{key:"getMiniAppInfo",value:function(){var e=this;return new Promise(function(t,i){e.miniAppInfo?t(e.miniAppInfo):e._callPrivateApi("getAppInfo",{appId:""},function(n){if(n&&n.value&&"true"==n.value.success&&n.value.appInfo)try{var a=JSON.parse(n.value.appInfo);e.miniAppInfo=a,t(a)}catch(e){i(n)}else i(n)})})}},{key:"getMiniAppScopeInfo",value:function(){var e=this;return new Promise(function(t,i){e.miniAppInfo&&e.miniAppInfo.permissions&&e.miniAppInfo.permissions.scopesV2?t(e.miniAppInfo.permissions.scopesV2):e._callPrivateApi("getAppInfo",{appId:""},function(n){if(n&&n.value&&"true"==n.value.success)try{var a=JSON.parse(n.value.appInfo);e.miniAppInfo=a;var o=a.permissions.scopesV2||[];t(o)}catch(e){i(n)}else i(n)})})}},{key:"isInWhiteList",value:function(){var e=this;return new Promise(function(t,i){e.getMiniAppInfo().then(function(n){e._callPrivateApi("queryEnableduaWhitlist",{},function(e){if(e&&e.value&&"true"==e.value.success)if("string"==typeof e.value.duaWhitlist)try{var a=JSON.parse(e.value.duaWhitlist);t(a.includes(n.appId)?!0:!1)}catch(e){t(!1)}else t(!1);else i(e)})})})}},{key:"isOpenMainSwith",value:function(){var e=this;return new Promise(function(t,i){e._callPrivateApi("queryEnableDevUserAgreement",{},function(e){e&&e.value.success&&"true"==e.value.success?t("boolean"==typeof e.value.enable&&e.value.enable?!0:!1):i(e)})})}},{key:"getStoreSignedInfo",value:function(e){var t=this;return new Promise(function(i,n){t._callPrivateApi("getFrameworkStorage",{key:"dlt_sign_auth_Info_".concat(e)},function(e){e&&void 0!==e.value&&void 0!==e.value.success&&"true"==e.value.success&&void 0!==e.value.data?i(e.value.data):n(e)})})}},{key:"storeSignedInfo",value:function(e,t){var i=this;this.getStoreSignedInfo(t).then(function(n){if(n)try{var a=JSON.parse(n);h(a,e,"version"),i._callPrivateApi("setFrameworkStorage",{key:"dlt_sign_auth_Info_".concat(t),data:JSON.stringify(a)})}catch(e){}else i._callPrivateApi("setFrameworkStorage",{key:"dlt_sign_auth_Info_".concat(t),data:JSON.stringify([e])})})}},{key:"storeAuthFetchTs",value:function(e){this._callPrivateApi("setFrameworkStorage",{key:"dlt_auth_fetch_ts",data:JSON.stringify(e)})}},{key:"getAuthFetchTs",value:function(){var e=this;return new Promise(function(t,i){e._callPrivateApi("getFrameworkStorage",{key:"dlt_auth_fetch_ts"},function(e){if(e&&e.value&&"true"==e.value.success)if(e.value.data)try{var n=JSON.parse(e.value.data);t(n)}catch(e){t({lastFetchTs:-1})}else t({lastFetchTs:-1});else i(e)})})}},{key:"isCollectUserInfo",value:function(){var e=this;return new Promise(function(t,i){e.getMiniAppInfo().then(function(e){t(void 0!==e.userAgreement&&1==e.userAgreement?!0:!1)})})}},{key:"showSignModal",value:function(){var e=this,t=this.miniAppInfo,i=t.userAgreementUrl,n=void 0===i?"":i,a=t.privacyPolicyUrl,o=void 0===a?"":a,r=t.linkAndButtonColor,s=void 0===r?"":r,u=t.processingMethod,c=t.userAgreementVersion,l=void 0===c?"":c,p=t.appId,d={titleMode:{text:"",mode:0==u?"1":"2"},content:"",agreementContent:"",privacyPolicyTv:"",userAgreementTv:"",privacyPolicyUrl:o,userAgreementUrl:n,btnBgColor:s,agreeBtn:"",cancelBtn:{text:"",mode:1==u?"1":"2"}};return new Promise(function(t,i){e._callPrivateApi("userAgreementDialogShow",d,function(i){i&&i.value&&"string"==typeof i.value.success&&"true"==i.value.success&&"string"==typeof i.value.status&&"show"==i.value.status?(e.report({agreementVersion:l,type:"0"}),e.report({agreementVersion:l,type:0==u?"4":"2"})):i&&i.value&&"string"==typeof i.value.success&&"true"==i.value.success&&"string"==typeof i.value.status&&"agreeClick"==i.value.status?(e.storeSignedInfo({version:l,timeStamp:(new Date).getTime()},p),e.report({agreementVersion:l,type:"1"}),t(!0)):i&&i.value&&"string"==typeof i.value.success&&"true"==i.value.success&&"string"==typeof i.value.status&&"cancelClick"==i.value.status&&(1==u?(e.report({agreementVersion:l,type:"3"}),e.exit(),t(!1)):(e.report({agreementVersion:l,type:"5"}),t(!1)))},!1)})}},{key:"isNeedToSignAgreement",value:function(){var e=this;return new Promise(function(t,i){e.getMiniAppInfo().then(function(i){var n=i.appId,a=i.userAgreementVersion;e.getStoreSignedInfo(n).then(function(e){e||t({needSign:!0,signedBefore:!1});try{var i=JSON.parse(e);if($(i)&&i.length>0){var n=-1;a&&(n=i.findIndex(function(e){return e.version===a})),t(-1==n?{needSign:!0,signedBefore:!0}:{needSign:!1,signedBefore:!0})}else t({needSign:!0,signedBefore:!1})}catch(e){}}).catch(console.log)})})}},{key:"checkDeveloperAuth",value:function(){var e=this;this.initStatus||(this.initStatus=!0,Promise.all([this.isInWhiteList(),this.isOpenMainSwith(),this.isCollectUserInfo(),this.isNeedToSignAgreement()]).then(function(t){var i=r(t,4),n=i[0],a=i[1],o=i[2],s=i[3];n||!a||o&&!s.needSign?(e._limitAuthCall=!1,e.callInterceptFn()):o&&s.needSign?e.showSignModal().then(function(t){t?(e._limitAuthCall=!1,e.callInterceptFn()):(s.signedBefore?e._limitAuthCall=!1:e._limitAuthCall=!0,e.callInterceptFn())}):(e._limitAuthCall=!0,e._notConfigDevModal=!0,e.callInterceptFn())}).catch(console.log))}},{key:"executeUserInfoApi",value:function(e){var i={allowStatus:J.allow,errMsg:"",errCode:0,realApiName:e};return this._limitAuthCall?"getUniqueId"===e?t(t({},i),{},{realApiName:"getTempUniqueId"}):t(t({},i),{},{allowStatus:J.reject,errMsg:Q.notAgreeAgreement.errMsg,errCode:Q.notAgreeAgreement.errCode}):i}},{key:"getAuthStatus",value:function(e,i){if(e.length<=0)return!1;var n=e.filter(function(e){return e.scopeName==i.scopeName});return n.length>0&&t({},n[0])}},{key:"executeUserInfoAuthApi",value:function(e,t,i){var n=this,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o={allowStatus:J.allow,errMsg:"",errCode:0,realApiName:e};return new Promise(function(r,s){if(n._intercept&&!a)return o.allowStatus=J.intercept,r(o);if(void 0!==t.rejectCall&&t.rejectCall)return o.allowStatus=J.reject,o.errCode=Q.noPermission.errCode,o.errMsg=Q.noPermission.errMsg,r(o);if(n._limitAuthCall&&t.userAuthorization&&"basic"!=t.apiType)return n._notConfigDevModal?(o.allowStatus=J.reject,o.errCode=Q.noPermission.errCode,o.errMsg=Q.noPermission.errMsg):(o.allowStatus=J.reject,o.errCode=Q.notAgreeAgreement.errCode,o.errMsg=Q.notAgreeAgreement.errMsg),r(o);if("basic"==t.apiType&&!t.userAuthorization)return"addToHomeScreen"==e?n.queryAddScreenNotShowAgainStatus().then(function(e){var t=(new Date).getTime();return 0!=e&&t-e<=n.SEVEN_DAYS?(o.errCode=Q.unauthorized.errCode,o.errMsg=Q.unauthorized.errMsg,
o.allowStatus=J.reject,r(o)):r(o)}):r(o);var u=!1;if(q.includes(e)){var c=i.appId||i.miniappId;if(c!=n.miniAppInfo.appId)return o.allowStatus=J.reject,o.errCode=Q.notThisMiniapp.errCode,o.errMsg=Q.notThisMiniapp.errMsg,r(o);n.queryMsgNotShowAgainStatus(c).then(function(e){var t=(new Date).getTime(),i=e.notShowAgain,a=e.timestamp;(0!=a&&t-a>n.SEVEN_DAYS||!i)&&(u=!0)})}n.getAuthorizationInfo().then(function(i){var a=n.getAuthStatus(i,t);if(!a||void 0!==a.authStatus&&a.authStatus==R.once&&a.authChangeTimeStamp<=n.start_ts||u&&a.authChangeTimeStamp<=n.start_ts&&a.authStatus==R.reject)n.getAuth(t,e).then(function(e){var t=e.clickBtn,i=e.isClickNotShowAgain,a=e.scopeName,s=e.authTimeStamp,u={scopeName:a,authTimeStamp:s,authChangeTimeStamp:s,authStatus:X[t.text],extraStatus:i?n.SEVEN_DAYS:0};h(n._localAuthRecordOrigin,u,"scopeName"),n.setLocalAuthRecord(n.miniAppInfo.appId,n._localAuthRecordOrigin),void 0!==X[t.text]&&X[t.text]==R.reject?(o.allowStatus=J.reject,o.errCode=Q.unauthorized.errCode,o.errMsg=Q.unauthorized.errMsg,r(o)):void 0!==X[t.text]&&X[t.text]==R.whileInUse?n.getMiniappResumedStatus().then(function(e){e?(o.allowStatus=J.allow,r(o)):(o.allowStatus=J.reject,o.errCode=Q.onlyWhileUsing.errCode,o.errMsg=Q.onlyWhileUsing.errMsg,r(o))}).catch(function(){o.allowStatus=J.reject,o.errCode=Q.innerError.errCode,o.errMsg=Q.innerError.errMsg,r(o)}):r(o)});else{var s=a.authStatus,c=a.extraStatus,l=a.authTimeStamp,p=(new Date).getTime(),d=c!=V.notSet&&p-l>c;s==R.reject||d&&"requestSendMsgPermission"!=e?(o.allowStatus=J.reject,o.errCode=Q.unauthorized.errCode,o.errMsg=Q.unauthorized.errMsg,r(o)):s==R.forever||a.authStatus==R.once&&a.authChangeTimeStamp>n.start_ts?(o.allowStatus=J.allow,n.updateAuthRecordSt(a),r(o)):n.getMiniappResumedStatus().then(function(e){e?(o.allowStatus=J.allow,n.updateAuthRecordSt(a),r(o)):(o.allowStatus=J.reject,o.errCode=Q.onlyWhileUsing.errCode,o.errMsg=Q.onlyWhileUsing.errMsg,r(o))}).catch(function(){o.allowStatus=J.reject,o.errCode=Q.innerError.errCode,o.errMsg=Q.innerError.errMsg,r(o)})}})})}},{key:"getAuthorizationInfo",value:function(){var e=this;return new Promise(function(t,i){var n=e.miniAppInfo;e.getLocalAuthRecord(n.appId).then(function(i){e._localAuthRecordOrigin=i,t(i)}).catch(console.log)})}},{key:"allowToCallNative",value:function(e,t){var i=this;return new Promise(function(n,a){var o={allowStatus:0,errMsg:"",errCode:0,realApiName:e};if(void 0===i._apiConfigs._authListConfig)i.generateAPIControl().then(function(a){var r=a[e],s=(null===r||void 0===r?void 0:r.apiType)||"commonAPI";i.executeAPI(s,n,o,e,r,t)});else{var r=i._apiConfigs[e],s=(null===r||void 0===r?void 0:r.apiType)||"commonAPI";i.executeAPI(s,n,o,e,r,t)}})}},{key:"allowToCallNativeIncept",value:function(e,t){var i=this;return new Promise(function(n,a){var o={allowStatus:0,errMsg:"",errCode:0,realApiName:e};if(void 0===i._apiConfigs._authListConfig)i.generateAPIControl().then(function(a){var r=a[e],s=(null===r||void 0===r?void 0:r.apiType)||"commonAPI";i.executeAPI(s,n,o,e,r,t,!0)});else{var r=i._apiConfigs[e],s=(null===r||void 0===r?void 0:r.apiType)||"commonAPI";i.executeAPI(s,n,o,e,r,t,!0)}})}},{key:"executeAPI",value:function(e,t,i,n,a,o,r){switch(e){case"basic":this.executeUserInfoAuthApi(n,a,o,r).then(function(e){t(e)});break;case"userInfo":var s=this.executeUserInfoApi(n);t(s);break;case"userInfoAuth":this.executeUserInfoAuthApi(n,a,o,r).then(function(e){t(e)});break;default:t(i)}}},{key:"getMiniappResumedStatus",value:function(){var e=this;return new Promise(function(t,i){e._callPrivateApi("getMiniappResumedStatus",{},function(e){e&&void 0!==e.value&&"true"==e.value.success?t(e.value.isResumed):i(e)})})}},{key:"saveTempAuth",value:function(e,t){this._callPrivateApi("setGlobalStorage",{globalFlag:"scope_storageV2",key:"dlt_api_auth_temp_".concat(e),dataType:"String",data:JSON.stringify(t)})}},{key:"queryAddScreenNotShowAgainStatus",value:function(){var e=this;return new Promise(function(t,i){var n=e.miniAppInfo;e._callPrivateApi("queryAddScreenNotShowAgainStatus",{miniappId:n.appId},function(e){e&&e.value&&"true"==e.value.success?t(e.value.timestamp):i(e)})})}},{key:"queryMsgNotShowAgainStatus",value:function(e){var t=this;return new Promise(function(i,n){t._callPrivateApi("queryMsgNotShowAgainStatus",{miniappId:e},function(e){e&&e.value&&"true"==e.value.success?i({notShowAgain:e.notShowAgain,timestamp:e.timestamp}):n(e)})})}},{key:"setLocalAuthRecord",value:function(e,t){this._callPrivateApi("setGlobalStorage",{globalFlag:"scope_storageV2",key:"key_allow_scope_list_".concat(e),dataType:"String",data:JSON.stringify(t)})}},{key:"exit",value:function(){this._callPrivateApi("exit",{},z)}},{key:"updateAuthRecordSt",value:function(e){var i=(new Date).getTime(),n=t(t({},e),{},{authTimeStamp:i,authChangeTimeStamp:i});h(this._localAuthRecordOrigin,n,"scopeName"),this.setLocalAuthRecord(this.miniAppInfo.appId,this._localAuthRecordOrigin)}},{key:"callInterceptFn",value:function(){var e=this,t=window["@transsion/byteh5bridge"];if(t&&t._interceptAPIS&&t._interceptAPIS.length>0){var i=t._interceptAPIS.shift(),n=i.realApiName,a=i.params;this.allowToCallNativeIncept(n,a).then(function(i){var n=i.allowStatus,o=i.errMsg,r=i.realApiName,s=i.errCode;switch(n){case J.allow:e._callPrivateApi(r,a,function(i){var n={success:"false"},o=i.value,r=void 0===o?n:o;"true"==r.success&&"function"==typeof a.success?a.success(r):"false"==r.success&&"function"==typeof a.fail&&a.fail(r),"function"==typeof a.complete&&a.complete(r),t._interceptAPIS.length>0?e.callStackFn():e._intercept=!1});break;case J.reject:var u=a.fail,c=a.complete;u&&u({errCode:s,errMsg:o}),c&&c({errCode:s,errMsg:o})}})}else this._intercept=!1}},{key:"report",value:function(e){this._callPrivateApi("report",{tag:"sign_authorization",reportData:JSON.stringify(e)},z)}}],[{key:"getInstance",value:function(){return this.instance||(this.instance=new e),this.instance}}]),e}(),te={onlyAddHome:"onlyAddHome",onlyPrivacy:"onlyPrivacy",addHomePrivacy:"addHomePrivacy"},ie=function(){function e(){i(this,e),this.readyToCheck(),this.checkedStatus=!1,this.dialogType=void 0,this.language="en",this.apiControl=ee.getInstance()}return a(e,[{key:"_callPrivateApi",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];B.callApi(e,t,function(e){i&&i(e)},n)}},{key:"readyToCheck",value:function(){var e=this,t=this;y(30).then(function(i){t.checkedStatus||e.checkLoadingSuccess().then(function(e){e&&t.checkStatus()})}).catch(function(i){t.checkedStatus||e.checkLoadingSuccess().then(function(e){e&&t.checkStatus()})}),document&&document.addEventListener("visibilitychange",function(){document.hidden||e.updatePrivacyAgreementDialog()})}},{key:"checkStatus",value:function(){var e=this;this.getUserPrivacyDialogType().then(function(t){var i=t.type,n=t.isNewUser;"hideDialog"==i?e.syncUserAllowStatus(!1).then(function(t){e.apiControl.checkDeveloperAuth()}):e.showPrivacyPannel(i,n).then(function(t){e.apiControl.checkDeveloperAuth()})}).catch(console.error)}},{key:"getAPIControl",value:function(){return this.apiControl}},{key:"isNewUser",value:function(){var e=this;return new Promise(function(t,i){e._callPrivateApi("getGlobalStorage",{globalFlag:"100000",key:"isNewUser",dataType:"Boolean",defaultValue:"true"},function(e){if(e&&e.value&&"true"==e.value.success){var n;t(null===(n=e.value)||void 0===n?void 0:n.data)}else i(e)})})}},{key:"isAgreeFrameworkPrivacy",value:function(){var e=this;return new Promise(function(t,i){e._callPrivateApi("getFrameworkStorage",{key:"dlt-privacy-aggrement"},function(e){e&&e.value&&"true"==e.value.success?t(void 0!==e.value.data&&"true"==e.value.data?!0:!1):i(e)})})}},{key:"isAgreeSDKPrivacy",value:function(){var e=this;return new Promise(function(t,i){e._callPrivateApi("getGlobalStorage",{globalFlag:"100000",key:"privacy_agreement",dataType:"Boolean"},function(e){if(e&&e.value&&"true"==e.value.success){var n;t(null===(n=e.value)||void 0===n?void 0:n.data)}else i(e)})})}},{key:"getMiniAppInfo",value:function(){var e=this;return new Promise(function(t,i){e._callPrivateApi("getMiniAppInfo",{},function(e){e&&e.value&&"true"==e.value.success?t(e.value):i(e)})})}},{key:"getLanguage",value:function(){var e=this;return new Promise(function(t,i){e._callPrivateApi("getSystemInfo",{},function(e){if(e&&e.value&&"true"==e.value.success){var n;t(null===(n=e.value)||void 0===n?void 0:n.language)}else i(e)})})}},{key:"getPrivacyWhiteList",value:function(e){var t=this;return new Promise(function(i,n){t._callPrivateApi("getPrivacyWhiteList",{appId:e},function(e){e&&e.value&&"true"==e.value.success?i(e):n(e)})})}},{key:"checkWhiteList",value:function(){var e=this;return new Promise(function(t,i){e.getMiniAppInfo().then(function(n){e.miniappInfo=n,e.getPrivacyWhiteList(n.appId).then(function(i){var n=i.value.privacyWhiteList,a=[];if(n)try{a=JSON.parse(n)}catch(e){}t(!!(a&&"[object Array]"===Object.prototype.toString.call(a)&&a.length>0)&&!!a.includes(e.miniappInfo.appId))}).catch(function(e){i(e)})})})}},{key:"showPrivacyPannel",value:function(e,t){var i=this;return this.checkedStatus=!0,this.dialogType=e,new Promise(function(n){Promise.all([i.getModalContent(e),i.isAutoAgreePrivacy()]).then(function(e){var a=r(e,2),o=a[0],s=a[1];if(o.isNewUser=t,s&&o.showPrivacy&&(o.showPrivacy=!1,!o.showAddHome)){var u=+new Date;return i.updatePrivacyStatus(),i.recordPrivacyData(u),i.syncUserAllowStatus(!0),i.dialogType=void 0,n(!0)}i._callPrivateApi("privacyAgreementDialogShow",o,function(e){if(e&&e.value&&"string"==typeof e.value.success&&"true"==e.value.success&&"string"==typeof e.value.status&&"agreeClick"==e.value.status){if(o.showPrivacy){var t=+new Date;i.updatePrivacyStatus(),i.recordPrivacyData(t)}o.showAddHome&&i.queryShortcutExists().then(function(e){e||i.addToHomeScreenInternal()}),i.syncUserAllowStatus(!0),i.dialogType=void 0,n(!0)}else e&&e.value&&"string"==typeof e.value.success&&"true"==e.value.success&&"string"==typeof e.value.status&&"cancel"==e.value.status&&i.exit()},"",!1)}).catch(console.error)})}},{key:"getModalContent",value:function(e){var t=this;return new Promise(function(i,n){t.getLanguage().then(function(n){var a=_.get(n)||_.get("en");t.language=n;var o=a.title,r=a.baseContent,s=a.privacyPolocyContent,u=a.userAgreementContent,c=a.buttonText,l=a.buttonTextGame,p=a.and,d=a.period,v=a.privacyAgreeTv,h=a.privacyCancelTv,g=a.gdprNoticeContent,f={titleMaxLine:0,title:o.addHome,baseContent:r+"###"+p+"****"+d,privacyPolocyContent:s,userAgreementContent:u,buttonText:c,privacyPolocyUrl:"https://h5.dlight-app.com/outside/privacy-policy?lang=",userAgreementUrl:"https://h5.dlight-app.com/outside/user-agreement?lang=",showAddHome:!0,showPrivacy:!0,useCustomPrivacyContent:!1,privacyAgreeTv:v,privacyCancelTv:h,gdprNoticeContent:g};e==te.onlyAddHome&&(f.baseContent="",f.showPrivacy=!1,f.addhomeCancelTv=h,delete f.privacyAgreeTv,delete f.privacyCancelTv,delete f.gdprNoticeContent),e==te.onlyPrivacy&&(f.title=o.privacy+"MiniApp",f.showAddHome=!1,f.titleMaxLine=1),e!=te.addHomePrivacy&&e!=te.onlyAddHome||!t.miniappInfo||void 0===t.miniappInfo.appCategoryType||"4"!=t.miniappInfo.appCategoryType||(f.title=o.addHomeGame,f.buttonText=l),i(f)}).catch(function(e){n(e)})})}},{key:"updatePrivacyStatus",value:function(){this._callPrivateApi("setGlobalStorage",{globalFlag:"100000",key:"privacy_agreement",dataType:"Boolean",data:"true"},z)}},{key:"isNeedToAddToHomeScreen",value:function(){var e=this;return new Promise(function(t,i){e.checkEnableMfah().then(function(n){n&&n.value&&"boolean"==typeof n.value.status&&!n.value.status?t(!1):e.getMiniAppInfo().then(function(n){e.miniappInfo=n,e.getForceAddHomeList(n.appId).then(function(n){var a=[];try{a=JSON.parse(n.value.forceList)}catch(e){}"[object Array]"===Object.prototype.toString.call(a)&&a.length>=0?a.includes(e.miniappInfo.appId)?t(!0):e._callPrivateApi("getLaunchOptions",{},function(e){if(e&&e.value&&"true"==e.value.success){var n=e.value.mfah;t(void 0!==n&&1==n?!0:!1)}else i(e)}):t(!1)}).catch(function(e){i(e)})})})})}},{key:"queryShortcutExists",value:function(){var e=this;return new Promise(function(t,i){e._callPrivateApi("queryShortcutExists",{},function(e){if(e&&e.value&&"true"==e.value.success){var n;t(null===(n=e.value)||void 0===n?void 0:n.isExist)}else i(e)})})}},{key:"addToHomeScreenInternal",value:function(){this._callPrivateApi("addToHomeScreenInternal",{location:"15",showConfirmDialog:!1,showSuccessToast:!0},z)}},{key:"syncUserAllowStatus",value:function(e){var t=this;return new Promise(function(i,n){t._callPrivateApi("syncUserAllowStatus",{appId:t.miniappInfo.appId,isClick:e},function(e){e&&e.value&&"true"==e.value.success?i(e):n(e)})})}},{key:"getForceAddHomeList",value:function(e){var t=this;return new Promise(function(i,n){t._callPrivateApi("getForceAddHomeList",{appId:e},function(e){e&&e.value&&"true"==e.value.success?i(e):n(e)})})}},{key:"checkEnableMfah",value:function(){var e=this;return new Promise(function(t,i){e._callPrivateApi("checkEnableMfah",{},function(e){e&&e.value&&"true"==e.value.success?t(e):i(e)})})}},{key:"updatePrivacyAgreementDialog",value:function(){var e=this;this.checkedStatus&&this.dialogType&&this.getUserPrivacyDialogType().then(function(t){var i=t.type,n=t.isNewUser;if("hideDialog"==i){var a=function(){e.syncUserAllowStatus(!1),e.dialogType=void 0};e.privacyAgreementDialogHide(a)}else"hideDialog"!=i&&i!=e.dialogType&&e.getModalContent(i).then(function(t){t.isNewUser=n,e.updatePrivacyDialogUI(t).catch(console.error)})})}},{key:"privacyAgreementDialogHide",value:function(e){var t=this;return new Promise(function(i,n){t._callPrivateApi("privacyAgreementDialogHide",{},function(t){t&&t.value&&"true"==t.value.success?(e&&e(),i(t)):n(t)})})}},{key:"getUserPrivacyDialogType",value:function(){var e=this;return new Promise(function(t,i){Promise.all([e.isNewUser(),e.isAgreeFrameworkPrivacy(),e.isAgreeSDKPrivacy(),e.checkWhiteList(),e.isNeedToAddToHomeScreen(),e.queryShortcutExists()]).then(function(e){var i=r(e,6),n=i[0],a=i[1],o=i[2],s=i[3],u=i[4],c=i[5];t(!n||a||o||s?u&&!c?{type:te.onlyAddHome,isNewUser:n}:{type:"hideDialog"}:u&&c||!u?{type:te.onlyPrivacy,isNewUser:n}:u&&!c?{type:te.addHomePrivacy,isNewUser:n}:{type:"hideDialog"})}).catch(function(e){i(e)})})}},{key:"checkLoadingSuccess",value:function(){var e=this;return new Promise(function(t,i){e._callPrivateApi("checkLoadingSuccess",{},function(e){e&&e.value&&"true"==e.value.success?t(e.value.isHideLoding?!0:!1):i(e)})})}},{key:"updatePrivacyDialogUI",value:function(e){var i=this;return new Promise(function(n,a){i._callPrivateApi("updatePrivacyDialogUI",t({},e),function(e){e&&e.value&&"true"==e.value.success?n(e):a(e)})})}},{key:"exit",value:function(){this._callPrivateApi("exit",{},z)}},{key:"recordPrivacyData",value:function(e){var t=this;this.getPrivacyInfo().then(function(i){var n=i.agreementVersion,a=i.privacyVersion,o=i.languageMap,r="en";Array.isArray(o)&&o.includes(t.language)&&(r=t.language);var s=JSON.stringify({click_ts:e,language:r,agreementVersion:n,privacyVersion:a});t._callPrivateApi("setGlobalStorage",{globalFlag:"100000",key:"privacy_agreement_data",dataType:"String",data:s},z),t._callPrivateApi("report",{tag:"sign_privacy_agreement",reportData:s},z)}).catch(console.error)}},{key:"getPrivacyInfo",value:function(){var e=this;return new Promise(function(t,i){e._callPrivateApi("request",{url:"https://app-oss.byte-app.com/common/json/privacyConfig.json"},function(e){if(e&&e.value&&"true"==e.value.success)try{var n=JSON.parse(e.value.response);t(n)}catch(e){i(e)}else i(e)})})}},{key:"isAutoAgreePrivacy",value:function(){var e=this;return new Promise(function(t,i){e._callPrivateApi("isAutoAgreePrivacy",{},function(e){if(console.log("isAutoAgreePrivacy",e),e&&e.value&&"true"==e.value.success){var i;t(null===(i=e.value)||void 0===i?void 0:i.autoAgree)}else t(!1)})})}}],[{key:"getInstance",value:function(){return this.instance||(this.instance=new e),this.instance}}]),e}();return ie.getInstance(),ie});
